{% extends 'base.html.j2' %}

{% block body %}
<h1>Game Lobby: <span id="lobby-name">{{ match.name }}</span></h1>

<div id="game-info">
    <p><strong>Match ID:</strong> {{ match.id }}</p>
    <p><strong>Host (Player 1):</strong> <span id="p1name">{{ match.p1name }}</span></p>
    <p><strong>Player 2:</strong> <span id="p2name">{{ match.p2name if match.p2name else 'Waiting for player...' }}</span></p>
    <p><strong>Your Role:</strong> {{ 'Host (Player 1)' if is_host else 'Player 2' }}</p>
    <p><strong>Status:</strong> <span id="status">{{ 'Ready to Start' if match.p2name else 'Waiting for opponent...' }}</span></p>
</div>

<br>
<a href="{{ url_for('matches') }}">Back to Matches</a>

<script>
    const matchId = {{ match.id }};
    
    function updateGameInfo() {
        fetch(`/api/match/${matchId}`)
            .then(response => response.json())
            .then(data => {
                if (data.error) return;
                
                document.getElementById('p1name').textContent = data.p1name;
                document.getElementById('p2name').textContent = data.p2name ? data.p2name : 'Waiting for player...';
                
                const statusSpan = document.getElementById('status');
                if (data.p2name) {
                    statusSpan.textContent = 'Ready to Start';
                } else {
                    statusSpan.textContent = 'Waiting for opponent...';
                }
            })
            .catch(error => console.error('Error fetching match data:', error));
    }

    // Poll every 2 seconds
    setInterval(updateGameInfo, 2000);
</script>
{% endblock %}
